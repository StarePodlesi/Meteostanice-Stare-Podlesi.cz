<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AktuÃ¡lnÃ­ poÄasÃ­ â€“ Meteostanice StarÃ© PodlesÃ­</title>
<style>
    body {
        background: linear-gradient(to right, #00bcd4, #ffffff);
        font-family: Arial, sans-serif;
        color: #333;
        margin: 0;
        padding: 0;
    }
    header {
        text-align: center;
        padding: 20px 10px;
    }
    header h1 {
        margin: 5px 0 10px 0;
        color: #00796b;
        font-size: 2.4em;
    }
    #datetime {
        font-weight: bold;
        color: #004d40;
        font-size: 1.2em;
    }
    .main-content {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        max-width: 1600px;
        margin: 0 auto;
        padding: 40px;
        gap: 20px;
        flex-wrap: wrap;
    }
    .container {
        background: #fff;
        border-radius: 20px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.25);
        padding: 40px;
        flex: 2;
        min-width: 400px;
        font-size: 1.4em;
        text-align: center;
    }
    .container h2 {
        color:#00796b; 
        margin-bottom:20px; 
        text-align:center; 
        font-size:2em; 
    }
    .weather-item {
        font-size: 1.4em;
        margin: 10px 0;
    }
    .emoji { margin-right: 8px; }
    .weather-item span.value { font-weight: bold; }
    #lastUpdate {
        margin-top:20px;
        font-style: italic;
        text-align: center;
        color: #555;
        font-size: 1.2em;
    }
    .sitemap {
        background: #fff;
        border-radius: 20px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.25);
        padding: 30px;
        flex: 1;
        min-width: 200px;
        font-size: 1.2em;
    }
    .sitemap h3 {
        color:#00796b;
        margin-bottom:20px;
        text-align:center;
        font-size:1.8em;
    }
    .sitemap a {
        display: block;
        color: #fff;
        background: #00796b;
        padding: 12px;
        border-radius: 10px;
        margin: 10px 0;
        text-decoration: none;
        transition: background-color 0.3s ease;
        text-align: center;
        font-size:1.2em;
    }
    .sitemap a:hover { background: #004d40; }
    #unitToggle {
        display:block;
        margin:20px auto;
        padding:10px 20px;
        background:#00796b;
        color:white;
        border:none;
        border-radius:8px;
        cursor:pointer;
        font-size:1.2em;
    }
    #unitToggle:hover { background:#004d40; }

    @media (max-width:900px){
        .main-content { 
            flex-direction: column; 
            align-items: center; 
            padding: 20px;
        }
        .container, .sitemap {
            flex: unset;
            width: 90%;
            font-size: 1.3em;
            padding: 20px;
        }
    }
</style>
</head>
<body>

<header>
    <h1>Meteostanice StarÃ© PodlesÃ­</h1>
    <div id="datetime"></div>
</header>

<div class="main-content">
    <div class="container">
        <h2>AktuÃ¡lnÃ­ poÄasÃ­</h2>
        <div id="weather"></div>
        <button id="unitToggle">PÅ™epnout na imperialnÃ­ jednotky</button>
        <div id="lastUpdate"></div>
    </div>

    <div class="sitemap">
        <h3>Mapa strÃ¡nek</h3>
        <a href="index.html">DomÅ¯</a>
        <a href="about.html">O meteostanici</a>
        <a href="records.html">Rekordy</a>
        <a href="map.html">Mapa</a>
        <a href="aktualnipocasi.html">PoÄasÃ­</a>
        <a href="fotogalerie.html">Fotogalerie</a>
    </div>
</div>

<script>
const STATION_ID = "IPODLE19";
const API_KEY = "0f95fd0f58a2451a95fd0f58a2a51a75";
let useMetric = true;

function getLast5MinutePoint(d=new Date()){
    const ms = d.getTime();
    const five = 5*60*1000;
    return new Date(Math.floor(ms/five)*five);
}

function updateDateTime(){
    const now = new Date();
    const days = ['NedÄ›le','PondÄ›lÃ­','ÃšterÃ½','StÅ™eda','ÄŒtvrtek','PÃ¡tek','Sobota'];
    const formatted = days[now.getDay()] + ", " +
        now.toLocaleDateString('cs-CZ') + " " +
        now.toLocaleTimeString('cs-CZ');
    document.getElementById("datetime").textContent = formatted;
}
setInterval(updateDateTime,1000);
updateDateTime();

document.getElementById("unitToggle").addEventListener("click",()=>{
    useMetric = !useMetric;
    document.getElementById("unitToggle").textContent = 
        useMetric ? "PÅ™epnout na imperialnÃ­ jednotky" : "PÅ™epnout na metrickÃ© jednotky";
    fetchWeather();
});

async function fetchWeather(){
    const url = `https://api.weather.com/v2/pws/observations/current?stationId=${STATION_ID}&format=json&units=${useMetric?"m":"e"}&apiKey=${API_KEY}`;
    try {
        const res = await fetch(url);
        const data = await res.json();
        const obs = data.observations[0];
        const m = obs.metric;
        const imperial = obs.imperial;

        const Z = 505;
        const p = useMetric ? m.pressure : imperial.pressure;
        const p_hpa = useMetric ? p : p*33.8639;
        const p0 = p_hpa * Math.pow(1 - (0.0065*Z)/(288.15), -5.257);
        const p0_display = useMetric ? p0.toFixed(1)+" hPa" : (p0/33.8639).toFixed(2)+" inHg";

        const html = `
            <div class="weather-item"><span class="emoji">ğŸŒ¡ï¸</span>Teplota vzduchu: <span class="value">${useMetric?m.temp+" Â°C":imperial.temp+" Â°F"}</span></div>
            <div class="weather-item"><span class="emoji">ğŸ’§</span>Vlhkost vzduchu: <span class="value">${obs.humidity} %</span></div>
            <div class="weather-item"><span class="emoji">ğŸ’¨</span>Rychlost vÄ›tru: <span class="value">${useMetric?m.windSpeed+" km/h":imperial.windSpeed+" mph"}</span></div>
            <div class="weather-item"><span class="emoji">ğŸ§­</span>SmÄ›r vÄ›tru: <span class="value">${obs.winddir}Â°</span></div>
            <div class="weather-item"><span class="emoji">ğŸŒ§ï¸</span>SrÃ¡Å¾ky dnes: <span class="value">${useMetric?m.precipTotal+" mm":imperial.precipTotal+" in"}</span></div>
            <div class="weather-item"><span class="emoji">â˜”</span>Intenzita srÃ¡Å¾ek: <span class="value">${useMetric?m.precipRate+" mm/h":imperial.precipRate+" in/h"}</span></div>
            <div class="weather-item"><span class="emoji">ğŸ§®</span>Tlak (mÄ›Å™enÃ½): <span class="value">${useMetric?m.pressure+" hPa":imperial.pressure+" inHg"}</span></div>
            <div class="weather-item"><span class="emoji">ğŸ“</span>Tlak (hladina moÅ™e): <span class="value">${p0_display}</span></div>
            <div class="weather-item"><span class="emoji">ğŸ”¥</span>TepelnÃ½ index: <span class="value">${useMetric?m.heatIndex+" Â°C":imperial.heatIndex+" Â°F"}</span></div>
            <div class="weather-item"><span class="emoji">â„ï¸</span>Chlad vÄ›tru: <span class="value">${useMetric?m.windChill+" Â°C":imperial.windChill+" Â°F"}</span></div>
            <div class="weather-item"><span class="emoji">ğŸŒ«ï¸</span>RosnÃ½ bod: <span class="value">${useMetric?m.dewpt+" Â°C":imperial.dewpt+" Â°F"}</span></div>
            <div class="weather-item"><span class="emoji">â›°ï¸</span>NadmoÅ™skÃ¡ vÃ½Å¡ka: <span class="value">${useMetric?Z+" m":(Z*3.28084).toFixed(0)+" ft"}</span></div>
        `;
        document.getElementById("weather").innerHTML = html;

        const last5 = getLast5MinutePoint(new Date());
        document.getElementById("lastUpdate").textContent =
            "PoslednÃ­ aktualizace: " + last5.toLocaleTimeString('cs-CZ');
    } catch(err){
        document.getElementById("weather").textContent = "Chyba naÄÃ­tÃ¡nÃ­ dat.";
        console.error(err);
    }
}

function scheduleNext(){
    const now = new Date();
    const five = 5*60*1000;
    const next = Math.ceil(now.getTime()/five)*five;
    const delay = next - now.getTime();
    setTimeout(()=>{
        fetchWeather();
        scheduleNext();
    }, delay);
}

fetchWeather();
scheduleNext();
</script>
</body>
</html>
