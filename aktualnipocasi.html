<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PoÄasÃ­ â€“ Meteostanice StarÃ© PodlesÃ­</title>
<style>
  body {
    background: linear-gradient(to right, #00bcd4, #ffffff);
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    display: flex;
    justify-content: center;
    min-height: 100vh;
  }

  .main-content {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    width: 90%;
    max-width: 1200px;
    gap: 16px;
  }

  .container {
    flex: 3;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    padding: 28px;
    text-align: center;
    min-width: 300px;
  }

  .sitemap {
    flex: 1;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    padding: 20px;
    min-width: 220px;
    align-self: stretch;
  }

  h1 { color:#00796b; margin:0 0 18px 0; font-size:28px; }
  ul.data-list { list-style:none; padding:0; margin:0 auto; max-width:720px; text-align:left; }
  ul.data-list li { line-height:1.8; font-size:1.05rem; }
  .center-text { text-align:center; }
  .toggle-btn {
    margin-top:18px;
    background:#00796b; color:#fff; border:none; padding:10px 18px;
    border-radius:10px; cursor:pointer; font-size:1rem;
  }
  .toggle-btn:hover{ background:#004d40; }

  .updated { margin-top:12px; color:#555; font-size:0.95rem; }

  @media (max-width:900px){
    .main-content { flex-direction:column; align-items:center; }
    .sitemap { width:90%; }
  }
</style>
</head>
<body>
  <div class="main-content">
    <div class="container">
      <h1>AktuÃ¡lnÃ­ poÄasÃ­ â€“ StarÃ© PodlesÃ­</h1>

      <p class="center-text">ğŸ“… <strong>AktuÃ¡lnÃ­ Äas:</strong> <span id="dateTime">â€”</span></p>

      <ul class="data-list">
        <li>ğŸŒ¡ <strong>Teplota:</strong> <span id="temp">â€”</span></li>
        <li>ğŸ’§ <strong>Vlhkost vzduchu:</strong> <span id="humidity">â€”</span></li>
        <li>ğŸ’¨ <strong>Rychlost vÄ›tru:</strong> <span id="windSpeed">â€”</span></li>
        <li>ğŸ§­ <strong>SmÄ›r vÄ›tru:</strong> <span id="windDir">â€”</span></li>
        <li>ğŸ“ <strong>Tlak (mÄ›Å™enÃ½):</strong> <span id="pressureMeasured">â€”</span></li>
        <li>ğŸŒ <strong>Tlak (pÅ™epoÄet na ÃºroveÅˆ moÅ™e):</strong> <span id="pressureSea">â€”</span></li>
        <li>ğŸŒ§ <strong>Intenzita srÃ¡Å¾ek:</strong> <span id="precipRate">â€”</span></li>
        <li>ğŸŒ¦ <strong>SrÃ¡Å¾ky za den:</strong> <span id="precipTotal">â€”</span></li>
        <li>ğŸ”¥ <strong>TepelnÃ½ index:</strong> <span id="heatIndex">â€”</span></li>
        <li>â„ï¸ <strong>Chlad vÄ›trem:</strong> <span id="windChill">â€”</span></li>
        <li>ğŸ’¦ <strong>RosnÃ½ bod:</strong> <span id="dewpt">â€”</span></li>
        <li>â›° <strong>NadmoÅ™skÃ¡ vÃ½Å¡ka:</strong> 505 m n. m.</li>
        <li class="updated center-text">â± <strong>PoslednÃ­ aktualizace dat:</strong> <span id="lastUpdate">â€”</span></li>
      </ul>

      <div class="center-text">
        <button id="unitToggle" class="toggle-btn">PÅ™epnout na imperiÃ¡lnÃ­ jednotky</button>
      </div>
    </div>

    <div class="sitemap">
      <h3 style="color:#00796b; margin-top:0">Mapa strÃ¡nek</h3>
      <a href="index.html" style="display:block;background:#00796b;color:#fff;padding:10px;border-radius:8px;text-decoration:none;margin-bottom:8px">DomÅ¯</a>
      <a href="about.html" style="display:block;background:#00796b;color:#fff;padding:10px;border-radius:8px;text-decoration:none;margin-bottom:8px">O meteostanici</a>
      <a href="records.html" style="display:block;background:#00796b;color:#fff;padding:10px;border-radius:8px;text-decoration:none;margin-bottom:8px">Rekordy</a>
      <a href="map.html" style="display:block;background:#00796b;color:#fff;padding:10px;border-radius:8px;text-decoration:none;margin-bottom:8px">Mapa</a>
      <a href="weather.html" style="display:block;background:#00796b;color:#fff;padding:10px;border-radius:8px;text-decoration:none;margin-bottom:8px">PoÄasÃ­</a>
      <a href="fotogalerie.html" style="display:block;background:#00796b;color:#fff;padding:10px;border-radius:8px;text-decoration:none">Fotogalerie</a>
    </div>
  </div>

<script>
/* -------- Konfigurace -------- */
const API_KEY = '0f95fd0f58a2451a95fd0f58a2a51a75';
const STATION_ID = 'IPODLE19';
const STATION_ELEV = 505; // m
let useMetric = true;

/* -------- PomocnÃ© konverze -------- */
const fToC = f => (Number(f) - 32) * 5/9;
const cToF = c => Number(c) * 9/5 + 32;
const inHgToHPa = inHg => Number(inHg) * 33.8638866667;
const hPaToInHg = hPa => Number(hPa) * 0.029529983071445;

/* BarometrickÃ¡ korekce na ÃºroveÅˆ moÅ™e (pÅ™ibliÅ¾nÃ¡) */
function seaLevelPressure_hPa(p_hPa, tempC, elev_m){
  // p_hPa = station pressure in hPa, tempC in Â°C, elev_m meters
  // standard barometric formula approximation
  const lapse = 0.0065;
  const gM = 5.257; // exponent
  const denom = tempC + lapse * elev_m + 273.15;
  const factor = 1 - (lapse * elev_m) / denom;
  const slp = p_hPa * Math.pow(factor, -gM);
  return Number(slp);
}

/* -------- Hodiny (aktuÃ¡lnÃ­ Äas) -------- */
function updateClock(){
  document.getElementById('dateTime').textContent = new Date().toLocaleString('cs-CZ');
}
setInterval(updateClock, 1000);
updateClock();

/* -------- NaÄtenÃ­ a zobrazenÃ­ dat -------- */
async function fetchWeather(){
  try{
    const units = useMetric ? 'm' : 'e';
    const url = `https://api.weather.com/v2/pws/observations/current?stationId=${encodeURIComponent(STATION_ID)}&format=json&units=${units}&apiKey=${encodeURIComponent(API_KEY)}`;
    const resp = await fetch(url);
    if(!resp.ok) throw new Error('Chyba pÅ™i volÃ¡nÃ­ API: ' + resp.status);
    const json = await resp.json();
    if(!json || !json.observations || !json.observations.length) throw new Error('NeplatnÃ¡ odpovÄ›Ä API');

    const o = json.observations[0];

    // zÃ­skat hodnoty vÅ¾dy jako "zÃ¡kladnÃ­" (metrickÃ©) pro vÃ½poÄty
    let tempC = null;
    if(o.metric && o.metric.temp != null) tempC = Number(o.metric.temp);
    else if(o.imperial && o.imperial.temp != null) tempC = fToC(o.imperial.temp);

    // mÄ›Å™enÃ½ tlak v hPa (pokud mÃ¡me jen inHg, pÅ™epoÄÃ­tÃ¡me)
    let pressure_hPa_measured = null;
    if(o.metric && o.metric.pressure != null) pressure_hPa_measured = Number(o.metric.pressure);
    else if(o.imperial && o.imperial.pressure != null) pressure_hPa_measured = inHgToHPa(o.imperial.pressure);

    // Pokud nÄ›kterÃ¡ pole chybÃ­, pouÅ¾ijeme rozumnÃ½ fallback
    const humidity = o.humidity != null ? o.humidity : (o.metric && o.metric.rh != null ? o.metric.rh : 'â€”');

    // pÅ™ipravÃ­me zobrazenÃ­ v poÅ¾adovanÃ½ch jednotkÃ¡ch
    // teplota
    let dispTemp = 'â€”';
    if(useMetric){
      const t = (o.metric && o.metric.temp != null) ? Number(o.metric.temp) : (o.imperial && o.imperial.temp != null ? fToC(o.imperial.temp) : null);
      if(t != null) dispTemp = Number(t).toFixed(1) + ' Â°C';
    } else {
      const t = (o.imperial && o.imperial.temp != null) ? Number(o.imperial.temp) : (o.metric && o.metric.temp != null ? cToF(o.metric.temp) : null);
      if(t != null) dispTemp = Number(t).toFixed(1) + ' Â°F';
    }

    // vlhkost
    const dispHumidity = humidity !== 'â€”' ? humidity + ' %' : 'â€”';

    // vÃ­tr
    let dispWindSpeed = 'â€”';
    if(useMetric){
      const v = o.metric && o.metric.windSpeed != null ? o.metric.windSpeed : (o.imperial && o.imperial.windSpeed != null ? Number(o.imperial.windSpeed) * 1.609344 : null);
      if(v != null) dispWindSpeed = Number(v).toFixed(1) + ' km/h';
    } else {
      const v = o.imperial && o.imperial.windSpeed != null ? o.imperial.windSpeed : (o.metric && o.metric.windSpeed != null ? Number(o.metric.windSpeed) / 1.609344 : null);
      if(v != null) dispWindSpeed = Number(v).toFixed(1) + ' mph';
    }

    const dispWindDir = o.winddir != null ? o.winddir + 'Â°' : 'â€”';

    // mÄ›Å™enÃ½ tlak ve zvolenÃ½ch jednotkÃ¡ch
    let dispPressureMeasured = 'â€”';
    if(pressure_hPa_measured != null){
      dispPressureMeasured = useMetric ? pressure_hPa_measured.toFixed(2) + ' hPa' : hPaToInHg(pressure_hPa_measured).toFixed(2) + ' inHg';
    }

    // pÅ™epoÄet na ÃºroveÅˆ moÅ™e (v hPa), pak zobrazit podle vybranÃ½ch jednotek
    let dispPressureSea = 'â€”';
    if(pressure_hPa_measured != null && tempC != null){
      const slp_hPa = seaLevelPressure_hPa(pressure_hPa_measured, tempC, STATION_ELEV);
      dispPressureSea = useMetric ? slp_hPa.toFixed(2) + ' hPa' : hPaToInHg(slp_hPa).toFixed(2) + ' inHg';
    }

    // srÃ¡Å¾ky (rate / total)
    let dispPrecipRate = 'â€”', dispPrecipTotal = 'â€”';
    if(useMetric){
      if(o.metric && o.metric.precipRate != null) dispPrecipRate = Number(o.metric.precipRate).toFixed(2) + ' mm/h';
      if(o.metric && o.metric.precipTotal != null) dispPrecipTotal = Number(o.metric.precipTotal).toFixed(2) + ' mm';
      // fallback z imperial
      if(dispPrecipRate === 'â€”' && o.imperial && o.imperial.precipRate != null) dispPrecipRate = (Number(o.imperial.precipRate) * 25.4).toFixed(2) + ' mm/h';
      if(dispPrecipTotal === 'â€”' && o.imperial && o.imperial.precipTotal != null) dispPrecipTotal = (Number(o.imperial.precipTotal) * 25.4).toFixed(2) + ' mm';
    } else {
      if(o.imperial && o.imperial.precipRate != null) dispPrecipRate = Number(o.imperial.precipRate).toFixed(2) + ' in/h';
      if(o.imperial && o.imperial.precipTotal != null) dispPrecipTotal = Number(o.imperial.precipTotal).toFixed(2) + ' in';
      if(dispPrecipRate === 'â€”' && o.metric && o.metric.precipRate != null) dispPrecipRate = (Number(o.metric.precipRate) / 25.4).toFixed(2) + ' in/h';
      if(dispPrecipTotal === 'â€”' && o.metric && o.metric.precipTotal != null) dispPrecipTotal = (Number(o.metric.precipTotal) / 25.4).toFixed(2) + ' in';
    }

    // heatIndex, windChill, dewpt
    let dispHeatIndex='â€”', dispWindChill='â€”', dispDew='â€”';
    if(useMetric){
      if(o.metric && o.metric.heatIndex != null) dispHeatIndex = Number(o.metric.heatIndex).toFixed(1) + ' Â°C';
      if(o.metric && o.metric.windChill != null) dispWindChill = Number(o.metric.windChill).toFixed(1) + ' Â°C';
      if(o.metric && o.metric.dewpt != null) dispDew = Number(o.metric.dewpt).toFixed(1) + ' Â°C';
      // fallbacks from imperial
      if(dispHeatIndex === 'â€”' && o.imperial && o.imperial.heatIndex != null) dispHeatIndex = fToC(o.imperial.heatIndex).toFixed(1) + ' Â°C';
      if(dispWindChill === 'â€”' && o.imperial && o.imperial.windChill != null) dispWindChill = fToC(o.imperial.windChill).toFixed(1) + ' Â°C';
      if(dispDew === 'â€”' && o.imperial && o.imperial.dewpt != null) dispDew = fToC(o.imperial.dewpt).toFixed(1) + ' Â°C';
    } else {
      if(o.imperial && o.imperial.heatIndex != null) dispHeatIndex = Number(o.imperial.heatIndex).toFixed(1) + ' Â°F';
      if(o.imperial && o.imperial.windChill != null) dispWindChill = Number(o.imperial.windChill).toFixed(1) + ' Â°F';
      if(o.imperial && o.imperial.dewpt != null) dispDew = Number(o.imperial.dewpt).toFixed(1) + ' Â°F';
      if(dispHeatIndex === 'â€”' && o.metric && o.metric.heatIndex != null) dispHeatIndex = cToF(o.metric.heatIndex).toFixed(1) + ' Â°F';
      if(dispWindChill === 'â€”' && o.metric && o.metric.windChill != null) dispWindChill = cToF(o.metric.windChill).toFixed(1) + ' Â°F';
      if(dispDew === 'â€”' && o.metric && o.metric.dewpt != null) dispDew = cToF(o.metric.dewpt).toFixed(1) + ' Â°F';
    }

    // zobrazit
    document.getElementById('temp').textContent = dispTemp;
    document.getElementById('humidity').textContent = dispHumidity;
    document.getElementById('windSpeed').textContent = dispWindSpeed;
    document.getElementById('windDir').textContent = dispWindDir;
    document.getElementById('pressureMeasured').textContent = dispPressureMeasured;
    document.getElementById('pressureSea').textContent = dispPressureSea;
    document.getElementById('precipRate').textContent = dispPrecipRate;
    document.getElementById('precipTotal').textContent = dispPrecipTotal;
    document.getElementById('heatIndex').textContent = dispHeatIndex;
    document.getElementById('windChill').textContent = dispWindChill;
    document.getElementById('dewpt').textContent = dispDew;

    // Äas poslednÃ­ aktualizace - preferuj obsTimeLocal pokud je k dispozici
    let last = 'â€”';
    if(o.obsTimeLocal) {
      // obsTimeLocal je obvykle "YYYY-MM-DD HH:MM:SS"
      try {
        const d = new Date(o.obsTimeLocal.replace(' ', 'T'));
        last = d.toLocaleString('cs-CZ');
      } catch(e){ last = o.obsTimeLocal; }
    } else if(o.obsTimeUtc) {
      last = new Date(o.obsTimeUtc).toLocaleString('cs-CZ');
    } else {
      last = new Date().toLocaleString('cs-CZ');
    }
    document.getElementById('lastUpdate').textContent = last;

  } catch(err){
    console.error('Chyba pÅ™i naÄÃ­tÃ¡nÃ­ poÄasÃ­:', err);
    document.getElementById('lastUpdate').textContent = 'Chyba naÄtenÃ­ dat';
  }
}

/* -------- PÅ™epÃ­nÃ¡nÃ­ jednotek (okamÅ¾itÄ› naÄte znovu) -------- */
document.getElementById('unitToggle').addEventListener('click', () => {
  useMetric = !useMetric;
  document.getElementById('unitToggle').textContent = useMetric ? 'PÅ™epnout na imperiÃ¡lnÃ­ jednotky' : 'PÅ™epnout na metrickÃ© jednotky';
  fetchWeather();
});

/* -------- SynchronizovanÃ¡ aktualizace kaÅ¾dÃ½ch 5 minut -------- */
function startScheduledFetch(){
  // prvnÃ­ okamÅ¾itÃ© naÄtenÃ­
  fetchWeather();

  // spoÄÃ­tat zpoÅ¾dÄ›nÃ­ do dalÅ¡Ã­ celÃ© 5-minuty (0:05,0:10,...)
  const now = new Date();
  const minutes = now.getMinutes();
  const minutesToAdd = (5 - (minutes % 5)) % 5; // 0..4
  const next = new Date(now.getFullYear(), now.getMonth(), now.getDate(), now.getHours(), minutes + minutesToAdd, 0, 0);
  if(next <= now) next.setMinutes(next.getMinutes() + 5);

  const delay = next.getTime() - now.getTime();
  setTimeout(() => {
    // naÄÃ­st hned na hranici a pak kaÅ¾dÃ½ch 5 minut
    fetchWeather();
    setInterval(fetchWeather, 5 * 60 * 1000);
  }, delay);
}

/* start */
startScheduledFetch();
</script>
</body>
</html>
