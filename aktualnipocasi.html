<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aktuální počasí – Staré Podlesí</title>
<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:linear-gradient(135deg,#aee1f9,#ffffff);
    display:flex;
    justify-content:center;
    padding:20px;
}
.container{
    background:#fff;
    border-radius:15px;
    box-shadow:0 0 15px rgba(0,0,0,0.2);
    max-width:600px;
    width:100%;
    padding:20px;
}
h1{
    text-align:center;
    color:#00796b;
    margin-bottom:20px;
}
ul{
    list-style:none;
    padding:0;
    font-size:1.2em;
    line-height:1.8em;
}
ul li span{
    margin-left:10px;
}
.togglebtn{
    display:block;
    margin:20px auto 0;
    background:#00796b;
    color:#fff;
    border:none;
    padding:12px 24px;
    border-radius:10px;
    cursor:pointer;
    font-size:1.1em;
    transition:background 0.3s;
}
.togglebtn:hover{background:#004d40;}
.updated{margin-top:15px;text-align:center;font-size:0.9em;color:#555;}
</style>
</head>
<body>
<div class="container">
<h1>Aktuální počasí – Staré Podlesí</h1>
<ul id="dataList">
  <li>📅 Datum a čas: <span id="currentTime">--</span></li>
  <li>🌡️ Teplota: <span id="temp">--</span></li>
  <li>💧 Vlhkost: <span id="humidity">--</span></li>
  <li>💨 Rychlost větru: <span id="wind">--</span></li>
  <li>🧭 Směr větru: <span id="windDir">--</span></li>
  <li>🌡️ Atmosférický tlak (na úrovni moře): <span id="pressure">--</span></li>
  <li>🌧️ Intenzita srážek: <span id="precipRate">--</span></li>
  <li>🌧️ Srážky za den: <span id="precipTotal">--</span></li>
  <li>🥵 Tepelný index: <span id="heatIndex">--</span></li>
  <li>🥶 Chlad větrem: <span id="windChill">--</span></li>
  <li>💧 Rosný bod: <span id="dewPoint">--</span></li>
  <li>⛰️ Nadmořská výška: 505 m n. m.</li>
</ul>
<p class="updated">⏱ Poslední aktualizace dat: <span id="lastUpdate">--</span></p>
<button class="togglebtn" onclick="toggleUnits()">Přepnout na imperiální jednotky</button>
</div>

<script>
const STATION_ID = "IPODLE19";
const API_KEY = "0f95fd0f58a2451a95fd0f58a2a51a75";
let useImperial = false;

// převod tlaku na úroveň moře (barometrická formule – jednoduchý aproxim.)
function seaLevelPressure(pressure, elevation, tempC){
    // pressure v hPa, elevation v m, tempC v °C
    const tempK = tempC + 273.15;
    return pressure * Math.exp((elevation / (29.3 * tempK)));
}

function updateClock(){
    const now = new Date();
    document.getElementById('currentTime').textContent = now.toLocaleString('cs-CZ');
}
setInterval(updateClock,1000);
updateClock();

async function fetchWeather(){
    const units = useImperial ? "e" : "m";
    const url = `https://api.weather.com/v2/pws/observations/current?stationId=${STATION_ID}&format=json&units=${units}&apiKey=${API_KEY}`;
    const resp = await fetch(url);
    if(!resp.ok) throw new Error("Chyba API");
    const data = await resp.json();
    const obs = data.observations[0];
    const elev = 505; // m
    const temp = obs.imperial ? (useImperial ? obs.imperial.temp : obs.metric.temp) : obs.metric.temp;
    const pressure = useImperial ? obs.imperial.pressure : obs.metric.pressure;
    const slp = seaLevelPressure(pressure, elev, temp);
    document.getElementById('temp').textContent = temp + (useImperial ? " °F" : " °C");
    document.getElementById('humidity').textContent = obs.humidity + " %";
    document.getElementById('wind').textContent = (useImperial ? obs.imperial.windSpeed + " mph" : obs.metric.windSpeed + " km/h");
    document.getElementById('windDir').textContent = obs.winddir + "°";
    document.getElementById('pressure').textContent = slp.toFixed(2) + (useImperial ? " inHg (SL)" : " hPa (SL)");
    document.getElementById('precipRate').textContent = (useImperial ? obs.imperial.precipRate + " in/h" : obs.metric.precipRate + " mm/h");
    document.getElementById('precipTotal').textContent = (useImperial ? obs.imperial.precipTotal + " in" : obs.metric.precipTotal + " mm");
    document.getElementById('heatIndex').textContent = (useImperial ? obs.imperial.heatIndex + " °F" : obs.metric.heatIndex + " °C");
    document.getElementById('windChill').textContent = (useImperial ? obs.imperial.windChill + " °F" : obs.metric.windChill + " °C");
    document.getElementById('dewPoint').textContent = (useImperial ? obs.imperial.dewpt + " °F" : obs.metric.dewpt + " °C");
    document.getElementById('lastUpdate').textContent =
        new Date(obs.obsTimeUtc).toLocaleString('cs-CZ',{timeZone:'UTC'}) + " UTC";
}

function toggleUnits(){
    useImperial = !useImperial;
    document.querySelector('.togglebtn').textContent = useImperial ?
        "Přepnout na metrické jednotky" : "Přepnout na imperiální jednotky";
    fetchWeather().catch(console.error);
}

// naplánování na nejbližší pětiminutovku
function scheduleFetch(){
    const now = new Date();
    const ms = now.getMinutes();
    const next = new Date(now);
    next.setSeconds(0,0);
    const addMin = 5 - (ms % 5);
    next.setMinutes(ms + addMin);
    const delay = next - now;
    setTimeout(function(){
        fetchWeather().catch(console.error);
        setInterval(()=>fetchWeather().catch(console.error), 5*60*1000);
    }, delay);
}

// První načtení hned a pak podle plánu
fetchWeather().catch(console.error);
scheduleFetch();
</script>
</body>
</html>
