<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aktuální počasí – Meteostanice Staré Podlesí</title>
<style>
    body {
        background: linear-gradient(to right, #00bcd4, #ffffff);
        font-family: Arial, sans-serif;
        color: #333;
        margin: 0;
        padding: 0;
    }
    header {
        text-align: center;
        padding: 20px 10px;
    }
    header h1 {
        margin: 5px 0 10px 0;
        color: #00796b;
        font-size: 2.2em;
    }
    #datetime {
        font-weight: bold;
        color: #004d40;
    }

    /* --- Hlavní rozvržení --- */
    .main-content {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        gap: 20px;
        flex-wrap: wrap; /* důležité pro zalomení na malé šířce */
    }
    .container, .sitemap {
        background: #fff;
        border-radius: 20px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.25);
        padding: 30px;
        flex: 1;
        min-width: 300px;
    }
    .container h2 { color:#00796b; margin-bottom:20px; text-align:center; }
    .weather-item {
        font-size: 1.2em;
        margin: 8px 0;
    }
    .emoji {
        margin-right: 8px;
    }
    #lastUpdate {
        margin-top:20px;
        font-style: italic;
        text-align: center;
        color: #555;
    }

    /* --- Mapa stránek --- */
    .sitemap h3 { color:#00796b; margin-bottom:20px; text-align:center; }
    .sitemap a {
        display: block;
        color: #fff;
        background: #00796b;
        padding: 12px;
        border-radius: 10px;
        margin: 10px 0;
        text-decoration: none;
        transition: background-color 0.3s ease;
        text-align: center;
    }
    .sitemap a:hover { background: #004d40; }

    /* --- Přepínač jednotek --- */
    #unitToggle {
        display:block;
        margin:15px auto;
        padding:8px 16px;
        background:#00796b;
        color:white;
        border:none;
        border-radius:8px;
        cursor:pointer;
        font-size:16px;
    }
    #unitToggle:hover { background:#004d40; }

    /* --- Responzivní úpravy --- */
    @media (max-width:900px){
        .main-content { flex-direction: column; align-items: center; }
    }
</style>
</head>
<body>

<header>
    <h1>Meteostanice Staré Podlesí</h1>
    <div id="datetime"></div>
</header>

<div class="main-content">
    <!-- Hlavní obsah -->
    <div class="container">
        <h2>Aktuální počasí</h2>
        <div id="weather"></div>
        <button id="unitToggle">Přepnout na imperial</button>
        <div id="lastUpdate"></div>
    </div>

    <!-- Pravý panel -->
    <div class="sitemap">
        <h3>Mapa stránek</h3>
        <a href="index.html">Domů</a>
        <a href="about.html">O meteostanici</a>
        <a href="records.html">Rekordy</a>
        <a href="map.html">Mapa</a>
        <a href="weather.html">Počasí</a>
        <a href="fotogalerie.html">Fotogalerie</a>
    </div>
</div>

<script>
// --- Nastavení ---
const STATION_ID = "IPODLE19";
const API_KEY = "0f95fd0f58a2451a95fd0f58a2a51a75";
let useMetric = true;

// Zaokrouhlení na nejbližší nižší 5-minutový bod
function getLast5MinutePoint(d=new Date()){
    const ms = d.getTime();
    const five = 5*60*1000;
    return new Date(Math.floor(ms/five)*five);
}

// Výpis aktuálního data a času (každou sekundu)
function updateDateTime(){
    const now = new Date();
    const days = ['Neděle','Pondělí','Úterý','Středa','Čtvrtek','Pátek','Sobota'];
    const formatted = days[now.getDay()] + ", " +
        now.toLocaleDateString('cs-CZ') + " " +
        now.toLocaleTimeString('cs-CZ');
    document.getElementById("datetime").textContent = formatted;
}
setInterval(updateDateTime,1000);
updateDateTime();

// Přepínač jednotek
document.getElementById("unitToggle").addEventListener("click",()=>{
    useMetric = !useMetric;
    document.getElementById("unitToggle").textContent = 
        useMetric ? "Přepnout na imperial" : "Switch to metric";
    fetchWeather(); // znovu načíst v jiných jednotkách
});

// --- Načtení dat z Weather Company ---
async function fetchWeather(){
    const url = `https://api.weather.com/v2/pws/observations/current?stationId=${STATION_ID}&format=json&units=${useMetric?"m":"e"}&apiKey=${API_KEY}`;
    try {
        const res = await fetch(url);
        const data = await res.json();
        const obs = data.observations[0];
        const m = obs.metric;
        const imp = obs.imperial;

        // Přepočet tlaku na hladinu moře (Z = 505 m)
        const Z = 505;
        const p = useMetric ? m.pressure : imp.pressure;       // hPa / inHg
        const p_hpa = useMetric ? p : p*33.8639;               // pro výpočet v hPa
        const p0 = p_hpa * Math.pow(1 - (0.0065*Z)/(288.15), -5.257);
        const p0_display = useMetric ? p0.toFixed(1)+" hPa" : (p0/33.8639).toFixed(2)+" inHg";

        // Jednotka teploty ručně (API ji u některých hodnot nedává)
        const tempUnit = useMetric ? "°C" : "°F";

        const html = `
            <div class="weather-item"><span class="emoji">🌡️</span>Teplota: ${useMetric?m.temp:imp.temp} ${tempUnit}</div>
            <div class="weather-item"><span class="emoji">💧</span>Vlhkost: ${obs.humidity} %</div>
            <div class="weather-item"><span class="emoji">💨</span>Vítr: ${useMetric?m.windSpeed+" km/h":imp.windSpeed+" mph"} směr ${obs.winddir}°</div>
            <div class="weather-item"><span class="emoji">🌧️</span>Srážky dnes: ${useMetric?m.precipTotal+" mm":imp.precipTotal+" in"}</div>
            <div class="weather-item"><span class="emoji">☔</span>Intenzita srážek: ${useMetric?m.precipRate+" mm/h":imp.precipRate+" in/h"}</div>
            <div class="weather-item"><span class="emoji">🧮</span>Tlak (hladina moře): ${p0_display}</div>
            <div class="weather-item"><span class="emoji">🔥</span>Tepelný index: ${useMetric?m.heatIndex:imp.heatIndex} ${tempUnit}</div>
            <div class="weather-item"><span class="emoji">❄️</span>Chlad větru: ${useMetric?m.windChill:imp.windChill} ${tempUnit}</div>
            <div class="weather-item"><span class="emoji">🌫️</span>Rosný bod: ${useMetric?m.dewpt:imp.dewpt} ${tempUnit}</div>
            <div class="weather-item"><span class="emoji">⛰️</span>Nadmořská výška: 505 m n. m.</div>
        `;
        document.getElementById("weather").innerHTML = html;

        // čas poslední aktualizace – poslední 5min bod
        const last5 = getLast5MinutePoint(new Date());
        document.getElementById("lastUpdate").textContent =
            "Poslední aktualizace: " + last5.toLocaleTimeString('cs-CZ');
    } catch(err){
        document.getElementById("weather").textContent = "Chyba načítání dat.";
        console.error(err);
    }
}

// --- Periodické načítání přesně v 5-minutových bodech ---
function scheduleNext(){
    const now = new Date();
    const five = 5*60*1000;
    const next = Math.ceil(now.getTime()/five)*five;
    const delay = next - now.getTime();
    setTimeout(()=>{
        fetchWeather();
        scheduleNext();
    }, delay);
}

// První načtení ihned a pak přesně každých 5 minut
fetchWeather();
scheduleNext();
</script>
</body>
</html>
