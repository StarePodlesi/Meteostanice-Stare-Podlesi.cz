<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meteostanice Staré Podlesí – Aktuální počasí</title>
<link rel="icon" href="favicon.ico.png" type="image/x-icon">
<style>
body{
    background:linear-gradient(to right,#00bcd4,#ffffff);
    font-family:Arial,sans-serif;
    color:#333;
    margin:0;
    padding:0;
}
header{
    text-align:center;
    padding:2vh 1vw;
}
header h1{
    margin:0.5vh 0 1vh 0;
    color:#00796b;
    font-size:4vw;
}
#datetime{
    font-weight:bold;
    color:#004d40;
    font-size:1.5vw;
}
.main-content{
    display:flex;
    justify-content:center;
    gap:2vw;
    flex-wrap:wrap;
    max-width:1600px;
    margin:0 auto;
    padding:2vh 1vw;
}
.container{
    background:#fff;
    border-radius:20px;
    box-shadow:0 8px 20px rgba(0,0,0,0.25);
    padding:2vh 2vw;
    flex:2;
    min-width:320px;
    max-height:100%;
    overflow-y:auto;
    font-size:1.2em;
    text-align:center;
    display:flex;
    flex-direction:column;
    align-items:center;
}
.container h2{
    color:#00796b;
    margin-bottom:1rem;
}
.sitemap{
    background:#fff;
    border-radius:20px;
    box-shadow:0 8px 20px rgba(0,0,0,0.25);
    padding:2vh 1vw;
    flex:1;
    min-width:200px;
    max-height:100%;
    overflow-y:auto;
    font-size:1.1em;
}
.sitemap h3{
    color:#00796b;
    margin-bottom:2vh;
    text-align:center;
}
.sitemap a{
    display:block;
    color:#fff;
    background:#00796b;
    padding:1vh 1vw;
    border-radius:10px;
    margin:1vh 0;
    text-decoration:none;
    text-align:center;
    font-size:1.1em;
    transition: background-color 0.3s ease;
}
.sitemap a:hover{background:#004d40;}
#unitToggle{
    display:block;
    margin:1.5rem auto;
    padding:0.8rem 2rem;
    background:#00796b;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-size:1.1em;
}
#unitToggle:hover{background:#004d40;}
#current{
    width:100%;
    background:#fff;
    border-radius:15px;
    padding:20px;
    box-shadow:0 6px 12px rgba(0,0,0,0.2);
    display:grid;
    grid-template-columns: 150px 1fr;
    gap:1rem;
    align-items:center;
}
#current .icon{
    text-align:center;
}
#current .details{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(180px,1fr));
    gap:10px;
    justify-content:center;
}
.detail-item{
    text-align:left;
}
#forecast{
    max-width:1000px;
    margin:2rem auto;
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:20px;
    justify-items:center;
}
.day{
    background:#fff;
    border-radius:15px;
    padding:15px;
    box-shadow:0 6px 12px rgba(0,0,0,0.2);
    text-align:center;
}
.day img{width:64px;height:64px;}
.day h3{margin-top:0;color:#00796b;font-size:1.2em;}
#lastUpdate{
    margin-top:1rem;
    font-size:0.9em;
    color:#555;
    text-align:center;
}
@media (max-width:900px){
    .main-content{flex-direction:column;align-items:center;}
    .container, .sitemap{width:90%;max-height:none;}
    #current{grid-template-columns:1fr;}
}
</style>
</head>
<body>

<header>
    <h1>Meteostanice Staré Podlesí</h1>
    <div id="datetime"></div>
</header>

<div class="main-content">
    <div class="container">
        <h2>Aktuální počasí</h2>
        <div id="current">
            <div class="icon">Načítám…</div>
            <div class="details"></div>
        </div>
        <button id="unitToggle">Přepnout na imperialní jednotky</button>
        <div id="lastUpdate"></div>
    </div>

    <div class="sitemap">
        <h3>Mapa stránek</h3>
        <a href="index.html">Domů</a>
        <a href="about.html">O meteostanici</a>
        <a href="records.html">Rekordy</a>
        <a href="map.html">Mapa</a>
        <a href="aktualnipocasi.html">Počasí</a>
        <a href="predpoved.html">Předpověď počasí</a>
        <a href="fotogalerie.html">Fotogalerie</a>
    </div>
</div>

<div id="forecast">Načítám předpověď…</div>

<script>
const API_KEY = "973fb2f7fb1a423193b170124251609";
const LAT = 49.69054;
const LON = 13.9811761;
let useMetric = true;

// 24h formát času
function updateDateTime(){
    const now = new Date();
    const days = ['Neděle','Pondělí','Úterý','Středa','Čtvrtek','Pátek','Sobota'];
    document.getElementById("datetime").textContent =
        `${days[now.getDay()]}, ${now.toLocaleDateString('cs-CZ')} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}:${now.getSeconds().toString().padStart(2,'0')}`;
}
setInterval(updateDateTime,1000);
updateDateTime();

// Přepínání jednotek
document.getElementById("unitToggle").addEventListener("click",()=>{
    useMetric = !useMetric;
    document.getElementById("unitToggle").textContent = useMetric ? 
        "Přepnout na imperialní jednotky" : "Přepnout na metrické jednotky";
    fetchWeather();
});

// Přepočtený tlak (pro demo)
function calcPressureMbToHpa(p) { return p; }

// Načtení aktuálního počasí a předpovědi
async function fetchWeather(){
    try{
        const res = await fetch(`https://api.weatherapi.com/v1/forecast.json?key=${API_KEY}&q=${LAT},${LON}&days=7&aqi=no&alerts=no&lang=cs`);
        const data = await res.json();
        const c = data.current;
        const iconDiv = document.querySelector("#current .icon");
        const detailsDiv = document.querySelector("#current .details");
        iconDiv.innerHTML = `<img src="https:${c.condition.icon}" alt="${c.condition.text}" width="100"><p><strong>${c.condition.text}</strong></p>`;
        detailsDiv.innerHTML = `
            <div class="detail-item">🌡️ Teplota: <strong>${useMetric?c.temp_c+" °C":c.temp_f+" °F"}</strong></div>
            <div class="detail-item">🤗 Pocitová: <strong>${useMetric?c.feelslike_c+" °C":c.feelslike_f+" °F"}</strong></div>
            <div class="detail-item">💧 Vlhkost: <strong>${c.humidity}%</strong></div>
            <div class="detail-item">☁️ Mraky: <strong>${c.cloud}%</strong></div>
            <div class="detail-item">💨 Vítr: <strong>${useMetric?c.wind_kph+" km/h":c.wind_mph+" mph"} ${c.wind_dir}</strong></div>
            <div class="detail-item">🌪️ Náraz větru: <strong>${useMetric?c.gust_kph+" km/h":c.gust_mph+" mph"}</strong></div>
            <div class="detail-item">🌧️ Srážky: <strong>${useMetric?c.precip_mm+" mm":c.precip_in+" in"}</strong></div>
            <div class="detail-item">🌡️ Tlak: <strong>${useMetric?c.pressure_mb+" hPa":c.pressure_in+" inHg"}</strong></div>
            <div class="detail-item">🔄 Přepočtený tlak: <strong>${useMetric?calcPressureMbToHpa(c.pressure_mb)+" hPa":c.pressure_in+" inHg"}</strong></div>
            <div class="detail-item">🌡️ Wind chill: <strong>${useMetric?c.windchill_c+" °C":c.windchill_f+" °F"}</strong></div>
            <div class="detail-item">🌡️ Heat index: <strong>${useMetric?c.heatindex_c+" °C":c.heatindex_f+" °F"}</strong></div>
            <div class="detail-item">🌡️ Dew point: <strong>${useMetric?c.dewpoint_c+" °C":c.dewpoint_f+" °F"}</strong></div>
            <div class="detail-item">☀️ UV index: <strong>${c.uv}</strong></div>
            <div class="detail-item">🌫️ Viditelnost: <strong>${useMetric?c.vis_km+" km":c.vis_miles+" mi"}</strong></div>
        `;

        // Předpověď
        const fc = data.forecast.forecastday;
        const container = document.getElementById("forecast");
        function formatDay(dateStr){
            const d = new Date(dateStr);
            const days = ['Neděle','Pondělí','Úterý','Středa','Čtvrtek','Pátek','Sobota'];
            const datum = d.toLocaleDateString("cs-CZ",{day:"numeric", month:"numeric"});
            return `${days[d.getDay()]} – ${datum}`;
        }
        container.innerHTML = fc.map(day=>{
            const cond = day.day.condition;
            const astro = day.astro;
            return `<div class="day">
                <h3>${formatDay(day.date)}</h3>
                <img src="https:${cond.icon}" alt="${cond.text}">
                <p><strong>${cond.text}</strong></p>
                <p>Max: <strong>${useMetric?day.day.maxtemp_c+" °C":day.day.maxtemp_f+" °F"}</strong></p>
                <p>Min: <strong>${useMetric?day.day.mintemp_c+" °C":day.day.mintemp_f+" °F"}</strong></p>
                <p>💨 Max vítr: <strong>${useMetric?day.day.maxwind_kph+" km/h":day.day.maxwind_mph+" mph"}</strong></p>
                <p>🌧️ Srážky: <strong>${useMetric?day.day.totalprecip_mm+" mm":day.day.totalprecip_in+" in"}</strong></p>
                <p>💧 Průměrná vlhkost: <strong>${day.day.avghumidity}%</strong></p>
                <p>☀️ UV index: <strong>${day.day.uv}</strong></p>
                <p>🌅 Východ slunce: <strong>${astro.sunrise}</strong></p>
                <p>🌇 Západ slunce: <strong>${astro.sunset}</strong></p>
            </div>`;
        }).join("");

        // Poslední aktualizace na celou hodinu
        const now = new Date();
        const lastHour = new Date(now);
        lastHour.setMinutes(0,0,0);
        document.getElementById("lastUpdate").textContent = `Poslední aktualizace: ${lastHour.getHours().toString().padStart(2,'0')}:00`;

    }catch(e){
        console.error(e);
        document.querySelector("#current .details").textContent = "Chyba při načítání aktuálního počasí.";
        document.getElementById("forecast").textContent = "Chyba při načítání předpovědi.";
    }
}

// Automatická aktualizace každou celou hodinu
function scheduleNextHour(){
    const now = new Date();
    const delay = (60 - now.getMinutes())*60*1000 - now.getSeconds()*1000 - now.getMilliseconds();
    setTimeout(async ()=>{
        await fetchWeather();
        scheduleNextHour();
    },delay);
}

fetchWeather();
scheduleNextHour();
</script>

</body>
</html>
