<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meteostanice Star√© Podles√≠ ‚Äì Aktu√°ln√≠ poƒças√≠</title>
<link rel="icon" href="favicon.ico.png" type="image/x-icon">
<style>
body{
    background:linear-gradient(to right,#00bcd4,#ffffff);
    font-family:Arial,sans-serif;
    color:#333;
    margin:0;
    padding:0;
}
header{
    text-align:center;
    padding:2vh 1vw;
}
header h1{
    margin:0.5vh 0 1vh 0;
    color:#00796b;
    font-size:4vw;
}
#datetime{
    font-weight:bold;
    color:#004d40;
    font-size:1.5vw;
}
.main-content{
    display:flex;
    justify-content:center;
    gap:2vw;
    flex-wrap:wrap;
    max-width:1600px;
    margin:0 auto;
    padding:2vh 1vw;
}
.container{
    background:#fff;
    border-radius:20px;
    box-shadow:0 8px 20px rgba(0,0,0,0.25);
    padding:2vh 2vw;
    flex:2;
    min-width:320px;
    max-height:100%;
    overflow-y:auto;
    font-size:1.4em;
    text-align:center;
}
.container h2{
    color:#00796b;
    margin-bottom:2vh;
}
.sitemap{
    background:#fff;
    border-radius:20px;
    box-shadow:0 8px 20px rgba(0,0,0,0.25);
    padding:2vh 1vw;
    flex:1;
    min-width:200px;
    max-height:100%;
    overflow-y:auto;
    font-size:1.2em;
}
.sitemap h3{
    color:#00796b;
    margin-bottom:2vh;
    text-align:center;
}
.sitemap a{
    display:block;
    color:#fff;
    background:#00796b;
    padding:1vh 1vw;
    border-radius:10px;
    margin:1vh 0;
    text-decoration:none;
    text-align:center;
    font-size:1.2em;
    transition: background-color 0.3s ease;
}
.sitemap a:hover{background:#004d40;}
#unitToggle{
    display:block;
    margin:2vh auto;
    padding:1vh 2vw;
    background:#00796b;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-size:1.2em;
}
#unitToggle:hover{background:#004d40;}
#current{
    max-width:100%;
    background:#f9f9f9;
    border-radius:15px;
    padding:20px;
    box-shadow:0 6px 12px rgba(0,0,0,0.2);
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:15px;
    justify-items:center;
    align-items:start;
}
.current-item{
    text-align:center;
    min-width:140px;
}
.current-item img{
    width:32px;
    height:32px;
}
#forecast{
    max-width:1200px;
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
    gap:20px;
    justify-items:center;
    margin:2vh auto;
}
.day{
    background:#fff;
    border-radius:15px;
    padding:15px;
    box-shadow:0 6px 12px rgba(0,0,0,0.2);
    transition:transform .2s;
    text-align:center;
}
.day:hover{transform:scale(1.05);}
.day img{width:64px;height:64px;}
.day h3{margin-top:0;color:#00796b;font-size:1.2em;}
#analogClock{
    margin:1rem auto;
    display:block;
    background:#f0f0f0;
    border-radius:50%;
    box-shadow:0 0 10px rgba(0,0,0,0.3);
}
#lastUpdate{
    margin-top:1rem;
    font-size:0.9em;
    color:#555;
    text-align:center;
}
@media (max-width:900px){
    .main-content{flex-direction:column;align-items:center;}
    .container, .sitemap{width:90%;max-height:none;}
}
</style>
</head>
<body>

<header>
    <h1>Meteostanice Star√© Podles√≠</h1>
    <div id="datetime"></div>
</header>

<div class="main-content">
    <div class="container">
        <h2>Aktu√°ln√≠ poƒças√≠</h2>
        <canvas id="analogClock" width="200" height="200"></canvas>
        <div id="current">Naƒç√≠t√°m aktu√°ln√≠ poƒças√≠‚Ä¶</div>
        <button id="unitToggle">P≈ôepnout na imperialn√≠ jednotky</button>
        <div id="lastUpdate"></div>
    </div>

    <div class="sitemap">
        <h3>Mapa str√°nek</h3>
        <a href="index.html">Dom≈Ø</a>
        <a href="about.html">O meteostanici</a>
        <a href="records.html">Rekordy</a>
        <a href="map.html">Mapa</a>
        <a href="aktualnipocasi.html">Poƒças√≠</a>
        <a href="predpoved.html">P≈ôedpovƒõƒè poƒças√≠</a>
        <a href="fotogalerie.html">Fotogalerie</a>
    </div>
</div>

<div id="forecast">Naƒç√≠t√°m p≈ôedpovƒõƒè‚Ä¶</div>

<script>
const API_KEY = "973fb2f7fb1a423193b170124251609";
const LAT = 49.69054;
const LON = 13.9811761;
let useMetric = true;

// Aktu√°ln√≠ ƒças v hlaviƒçce
function updateDateTime(){
    const now = new Date();
    const days = ['Nedƒõle','Pondƒõl√≠','√öter√Ω','St≈ôeda','ƒåtvrtek','P√°tek','Sobota'];
    document.getElementById("datetime").textContent =
        `${days[now.getDay()]}, ${now.toLocaleDateString('cs-CZ')} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}:${now.getSeconds().toString().padStart(2,'0')}`;
}
setInterval(updateDateTime,1000);
updateDateTime();

// P≈ôep√≠n√°n√≠ jednotek
document.getElementById("unitToggle").addEventListener("click",()=>{
    useMetric = !useMetric;
    document.getElementById("unitToggle").textContent = useMetric ? 
        "P≈ôepnout na imperialn√≠ jednotky" : "P≈ôepnout na metrick√© jednotky";
    fetchWeather();
});

// Analogov√© hodiny
function drawAnalogClock(){
    const canvas = document.getElementById("analogClock");
    const ctx = canvas.getContext("2d");
    const radius = canvas.height/2;
    ctx.translate(radius,radius);
    function drawClock(){
        ctx.clearRect(-radius,-radius,canvas.width,canvas.height);
        drawFace(ctx,radius);
        drawNumbers(ctx,radius);
        drawTime(ctx,radius);
    }
    function drawFace(ctx,radius){
        ctx.beginPath();
        ctx.arc(0,0,radius,0,2*Math.PI);
        ctx.fillStyle='white';
        ctx.fill();
        ctx.strokeStyle='#00796b';
        ctx.lineWidth=8;
        ctx.stroke();
    }
    function drawNumbers(ctx,radius){
        ctx.font = radius*0.15+"px arial";
        ctx.textBaseline="middle";
        ctx.textAlign="center";
        for(let num=1;num<=12;num++){
            let ang=num*Math.PI/6;
            ctx.rotate(ang);
            ctx.translate(0,-radius*0.85);
            ctx.rotate(-ang);
            ctx.fillStyle='#004d40';
            ctx.fillText(num.toString(),0,0);
            ctx.rotate(ang);
            ctx.translate(0,radius*0.85);
            ctx.rotate(-ang);
        }
    }
    function drawTime(ctx,radius){
        const now=new Date();
        let hour=now.getHours()%12;
        let minute=now.getMinutes();
        let second=now.getSeconds();
        hour=(hour*Math.PI/6)+(minute*Math.PI/(6*60))+(second*Math.PI/(360*60));
        drawHand(ctx,hour,radius*0.5,radius*0.07);
        minute=(minute*Math.PI/30)+(second*Math.PI/(30*60));
        drawHand(ctx,minute,radius*0.8,radius*0.07);
        second=(second*Math.PI/30);
        drawHand(ctx,second,radius*0.9,radius*0.02,'red');
    }
    function drawHand(ctx,pos,length,width,color='#004d40'){
        ctx.beginPath();
        ctx.lineWidth=width;
        ctx.lineCap="round";
        ctx.strokeStyle=color;
        ctx.moveTo(0,0);
        ctx.rotate(pos);
        ctx.lineTo(0,-length);
        ctx.stroke();
        ctx.rotate(-pos);
    }
    setInterval(drawClock,1000);
}
drawAnalogClock();

// P≈ôeklad f√°z√≠ mƒõs√≠ce do ƒçe≈°tiny
const moonPhases = {
    "New Moon":"Nov",
    "Waxing Crescent":"Dor≈Østaj√≠c√≠ srpek",
    "First Quarter":"Prvn√≠ ƒçtvrt",
    "Waxing Gibbous":"Dor≈Østaj√≠c√≠ mƒõs√≠c",
    "Full Moon":"√öplnƒõk",
    "Waning Gibbous":"Ub√Ωvaj√≠c√≠ mƒõs√≠c",
    "Last Quarter":"Posledn√≠ ƒçtvrt",
    "Waning Crescent":"Ub√Ωvaj√≠c√≠ srpek"
};

// Naƒçten√≠ poƒças√≠
async function fetchWeather(){
    try{
        const res = await fetch(`https://api.weatherapi.com/v1/forecast.json?key=${API_KEY}&q=${LAT},${LON}&days=7&aqi=no&alerts=no&lang=cs`);
        const data = await res.json();

        const c = data.current;
        const currentContainer = document.getElementById("current");
        currentContainer.innerHTML = "";

        const currentFields = [
            ["üå°Ô∏è Teplota", useMetric?c.temp_c+" ¬∞C":c.temp_f+" ¬∞F"],
            ["ü§Ø Pocitov√° teplota", useMetric?c.feelslike_c+" ¬∞C":c.feelslike_f+" ¬∞F"],
            ["üí® V√≠tr", useMetric?c.wind_kph+" km/h":c.wind_mph+" mph"],
            ["üß≠ Smƒõr vƒõtru", c.wind_dir],
            ["üå™Ô∏è N√°razy vƒõtru", useMetric?c.gust_kph+" km/h":c.gust_mph+" mph"],
            ["üìè Tlak", useMetric?c.pressure_mb+" hPa":c.pressure_in+" inHg"],
            ["üåßÔ∏è Sr√°≈æky", useMetric?c.precip_mm+" mm":c.precip_in+" in"],
            ["üíß Vlhkost", c.humidity+" %"],
            ["‚òÅÔ∏è Mraky", c.cloud+" %"],
            ["üå´Ô∏è Viditelnost", useMetric?c.vis_km+" km":c.vis_miles+" mi"],
            ["‚òÄÔ∏è UV index", c.uv],
            ["üíß Rosn√Ω bod", useMetric?c.dewpoint_c+" ¬∞C":c.dewpoint_f+" ¬∞F"],
            ["‚ùÑÔ∏è Wind Chill", useMetric?c.windchill_c+" ¬∞C":c.windchill_f+" ¬∞F"],
            ["üî• Heat index", useMetric?c.heatindex_c+" ¬∞C":c.heatindex_f+" ¬∞F"]
        ];

        currentFields.forEach(([label,value])=>{
            const div = document.createElement("div");
            div.className="current-item";
            div.innerHTML = `<strong>${label}:</strong> ${value}`;
            currentContainer.appendChild(div);
        });

        // T√Ωdenn√≠ p≈ôedpovƒõƒè
        const fc = data.forecast.forecastday;
        const container = document.getElementById("forecast");
        container.innerHTML = fc.map(day=>{
            const cond = day.day;
            const astro = day.astro;
            const d = new Date(day.date);
            const days = ['Nedƒõle','Pondƒõl√≠','√öter√Ω','St≈ôeda','ƒåtvrtek','P√°tek','Sobota'];
            const datum = d.toLocaleDateString("cs-CZ",{day:"numeric",month:"numeric"});
            function to24h(timeStr){
                // timeStr je form√°t "6:35 AM" ‚Äì p≈ôevedeme na 24h
                let [time,ampm] = timeStr.split(" ");
                let [h,m] = time.split(":").map(Number);
                if(ampm==="PM" && h<12) h+=12;
                if(ampm==="AM" && h===12) h=0;
                return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
            }
            return `<div class="day">
                <h3>${days[d.getDay()]} ‚Äì ${datum}</h3>
                <img src="https:${cond.condition.icon}" alt="${cond.condition.text}">
                <p><strong>${cond.condition.text}</strong></p>
                <p>üå°Ô∏è Max: <strong>${useMetric?cond.maxtemp_c+" ¬∞C":cond.maxtemp_f+" ¬∞F"}</strong></p>
                <p>üå°Ô∏è Min: <strong>${useMetric?cond.mintemp_c+" ¬∞C":cond.mintemp_f+" ¬∞F"}</strong></p>
                <p>üí® Max v√≠tr: <strong>${useMetric?cond.maxwind_kph+" km/h":cond.maxwind_mph+" mph"}</strong></p>
                <p>üåßÔ∏è Sr√°≈æky: <strong>${useMetric?cond.totalprecip_mm+" mm":cond.totalprecip_in+" in"}</strong></p>
                <p>üíß Pr≈Ømƒõrn√° vlhkost: <strong>${cond.avghumidity} %</strong></p>
                <p>‚òÄÔ∏è UV index: <strong>${cond.uv}</strong></p>
                <p>üåÖ V√Ωchod slunce: <strong>${to24h(astro.sunrise)}</strong></p>
                <p>üåá Z√°pad slunce: <strong>${to24h(astro.sunset)}</strong></p>
                <p>üåï F√°ze mƒõs√≠ce: <strong>${moonPhases[astro.moon_phase] || astro.moon_phase}</strong></p>
            </div>`;
        }).join("");

        // Posledn√≠ aktualizace ‚Äì na celou hodinu
        const now = new Date();
        const lastUpdate = new Date();
        lastUpdate.setMinutes(0,0,0);
        document.getElementById("lastUpdate").textContent =
            `Posledn√≠ aktualizace: ${lastUpdate.toLocaleString('cs-CZ',{hour12:false})}`;

    }catch(e){
        console.error(e);
        document.getElementById("current").textContent = "Chyba p≈ôi naƒç√≠t√°n√≠ aktu√°ln√≠ho poƒças√≠.";
        document.getElementById("forecast").textContent = "Chyba p≈ôi naƒç√≠t√°n√≠ p≈ôedpovƒõdi.";
    }
}

// Automatick√° aktualizace dat ka≈ædou hodinu (bez reloadu str√°nky)
function scheduleNext(){
    const now = new Date();
    const nextHour = new Date();
    nextHour.setHours(now.getHours()+1,0,0,0);
    const delay = nextHour - now;
    setTimeout(async ()=>{
        await fetchWeather();
        scheduleNext();
    }, delay);
}

// ‚ñ∫ Automatick√Ω kompletn√≠ reload cel√© str√°nky ka≈ædou celou hodinu
(function reloadFullPageOnFullHour() {
    const now = new Date();
    const nextHour = new Date();
    nextHour.setHours(now.getHours() + 1, 0, 0, 0);
    const delay = nextHour.getTime() - now.getTime();
    setTimeout(function () {
        location.reload(true); // znovu naƒçte celou str√°nku
    }, delay);
})();

fetchWeather();
scheduleNext();
</script>

</body>
</html>
