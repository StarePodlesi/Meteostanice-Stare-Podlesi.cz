<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Meteostanice Staré Podlesí – Aktuální počasí</title>
<link rel="icon" href="favicon.ico.png" type="image/x-icon">
<style>
body{
    background:linear-gradient(to right,#00bcd4,#ffffff);
    font-family:Arial,sans-serif;
    color:#333;
    margin:0;
    padding:0;
}
header{
    text-align:center;
    padding:2vh 1vw;
}
header h1{
    margin:0.5vh 0 1vh 0;
    color:#00796b;
    font-size:4vw;
}
#datetime{
    font-weight:bold;
    color:#004d40;
    font-size:1.5vw;
}
.main-content{
    display:flex;
    justify-content:center;
    gap:2vw;
    flex-wrap:wrap;
    max-width:1600px;
    margin:0 auto;
    padding:2vh 1vw;
}
.container{
    background:#fff;
    border-radius:20px;
    box-shadow:0 8px 20px rgba(0,0,0,0.25);
    padding:2vh 2vw;
    flex:2;
    min-width:300px;
    max-height:100%;
    overflow-y:auto;
    font-size:1.4em;
    text-align:center;
    position:relative;
}
.container h2{
    color:#00796b;
    margin-bottom:2vh;
}
.sitemap{
    background:#fff;
    border-radius:20px;
    box-shadow:0 8px 20px rgba(0,0,0,0.25);
    padding:2vh 1vw;
    flex:1;
    min-width:200px;
    max-height:100%;
    overflow-y:auto;
    font-size:1.2em;
}
.sitemap h3{
    color:#00796b;
    margin-bottom:2vh;
    text-align:center;
}
.sitemap a{
    display:block;
    color:#fff;
    background:#00796b;
    padding:1vh 1vw;
    border-radius:10px;
    margin:1vh 0;
    text-decoration:none;
    text-align:center;
    font-size:1.2em;
    transition: background-color 0.3s ease;
}
.sitemap a:hover{background:#004d40;}
#unitToggle{
    display:block;
    margin:2vh auto;
    padding:1vh 2vw;
    background:#00796b;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-size:1.2em;
}
#unitToggle:hover{background:#004d40;}
#forecast{
    max-width:1000px;
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:20px;
    padding:0 10px;
    margin:2vh auto;
}
.day{
    background:#fff;
    border-radius:15px;
    padding:15px;
    box-shadow:0 6px 12px rgba(0,0,0,0.2);
    transition:transform .2s;
}
.day:hover{transform:scale(1.05);}
.day img{width:64px;height:64px;}
.day h3{margin-top:0;color:#00796b;font-size:1.2em;}
#analogClock{
    margin:1rem auto;
    display:block;
    background:#f0f0f0;
    border-radius:50%;
    box-shadow:0 0 10px rgba(0,0,0,0.3);
}
#lastUpdate{
    margin-top:1rem;
    font-size:0.9em;
    color:#555;
}
@media (max-width:900px){
    .main-content{flex-direction:column;align-items:center;}
    .container, .sitemap{width:90%;max-height:none;}
}
</style>
</head>
<body>

<header>
    <h1>Meteostanice Staré Podlesí</h1>
    <div id="datetime"></div>
</header>

<div class="main-content">
    <div class="container">
        <h2>Aktuální počasí</h2>
        <canvas id="analogClock" width="200" height="200"></canvas>
        <div id="current" style="display:flex;flex-wrap:wrap;justify-content:space-between;gap:20px;">

            <div style="flex:1; min-width:180px; text-align:center;">
                <img src="" id="weatherIcon" alt="Počasí" style="width:80px;height:80px;">
                <p id="weatherText"><strong>Načítám…</strong></p>
                <p>🌡️ Teplota: <strong id="temp">… °C</strong></p>
                <p>🤗 Pocitová: <strong id="feelslike">… °C</strong></p>
                <p>🌫️ Rosný bod: <strong id="dewpoint">… °C</strong></p>
                <p>☁️ Mraky: <strong id="cloud">…%</strong></p>
            </div>

            <div style="flex:1; min-width:180px; text-align:center;">
                <p>💨 Vítr: <strong id="wind">… km/h</strong></p>
                <p>🌪️ Náraz větru: <strong id="gust">… km/h</strong></p>
                <p>🌡️ Chlad větru: <strong id="windchill">… °C</strong></p>
                <p>🔥 Tepelný index: <strong id="heatindex">… °C</strong></p>
            </div>

            <div style="flex:1; min-width:180px; text-align:center;">
                <p>🌧️ Srážky: <strong id="precip">… mm</strong></p>
                <p>⛈️ Intenzita srážek: <strong id="precipIntensity">… mm/h</strong></p>
                <p>🌡️ Tlak: <strong id="pressure">… hPa</strong></p>
                <p>☀️ UV index: <strong id="uv">…</strong></p>
                <p>👁️ Viditelnost: <strong id="vis">… km</strong></p>
            </div>

            <div style="flex:1; min-width:180px; text-align:center;">
                <p>🌅 Východ slunce: <strong id="sunrise">…</strong></p>
                <p>🌇 Západ slunce: <strong id="sunset">…</strong></p>
                <p>🌙 Východ měsíce: <strong id="moonrise">…</strong></p>
                <p>🌙 Západ měsíce: <strong id="moonset">…</strong></p>
                <p>🌕 Fáze měsíce: <strong id="moonPhase">…</strong></p>
                <p id="moonPercent">Viditelnost: …%</p>
            </div>

        </div>
        <button id="unitToggle">Přepnout na imperialní jednotky</button>
        <div id="lastUpdate"></div>
    </div>

    <div class="sitemap">
        <h3>Mapa stránek</h3>
        <a href="index.html">Domů</a>
        <a href="about.html">O meteostanici</a>
        <a href="records.html">Rekordy</a>
        <a href="map.html">Mapa</a>
        <a href="aktualnipocasi.html">Počasí</a>
        <a href="predpoved.html">Předpověď počasí</a>
        <a href="fotogalerie.html">Fotogalerie</a>
    </div>
</div>

<div id="forecast">Načítám předpověď…</div>

<script>
const API_KEY = "973fb2f7fb1a423193b170124251609";
const LAT = 49.69054;
const LON = 13.9811761;
let useMetric = true;

// Datum a čas
function updateDateTime(){
    const now = new Date();
    const days = ['Neděle','Pondělí','Úterý','Středa','Čtvrtek','Pátek','Sobota'];
    document.getElementById("datetime").textContent =
        `${days[now.getDay()]}, ${now.toLocaleDateString('cs-CZ')} ${now.toLocaleTimeString('cs-CZ')}`;
}
setInterval(updateDateTime,1000);
updateDateTime();

// Přepínání jednotek
document.getElementById("unitToggle").addEventListener("click",()=>{
    useMetric = !useMetric;
    document.getElementById("unitToggle").textContent = useMetric ? 
        "Přepnout na imperialní jednotky" : "Přepnout na metrické jednotky";
    fetchWeather();
});

// Analogové hodiny
function drawAnalogClock(){
    const canvas = document.getElementById("analogClock");
    const ctx = canvas.getContext("2d");
    const radius = canvas.height/2;
    ctx.translate(radius,radius);
    function drawClock(){
        ctx.clearRect(-radius,-radius,canvas.width,canvas.height);
        drawFace(ctx,radius);
        drawNumbers(ctx,radius);
        drawTime(ctx,radius);
    }
    function drawFace(ctx,radius){
        ctx.beginPath();
        ctx.arc(0,0,radius,0,2*Math.PI);
        ctx.fillStyle='white';
        ctx.fill();
        ctx.strokeStyle='#00796b';
        ctx.lineWidth=8;
        ctx.stroke();
    }
    function drawNumbers(ctx,radius){
        ctx.font = radius*0.15+"px arial";
        ctx.textBaseline="middle";
        ctx.textAlign="center";
        for(let num=1;num<=12;num++){
            let ang=num*Math.PI/6;
            ctx.rotate(ang);
            ctx.translate(0,-radius*0.85);
            ctx.rotate(-ang);
            ctx.fillStyle='#004d40';
            ctx.fillText(num.toString(),0,0);
            ctx.rotate(ang);
            ctx.translate(0,radius*0.85);
            ctx.rotate(-ang);
        }
    }
    function drawTime(ctx,radius){
        const now=new Date();
        let hour=now.getHours()%12;
        let minute=now.getMinutes();
        let second=now.getSeconds();
        hour=(hour*Math.PI/6)+(minute*Math.PI/(6*60))+(second*Math.PI/(360*60));
        drawHand(ctx,hour,radius*0.5,radius*0.07);
        minute=(minute*Math.PI/30)+(second*Math.PI/(30*60));
        drawHand(ctx,minute,radius*0.8,radius*0.07);
        second=(second*Math.PI/30);
        drawHand(ctx,second,radius*0.9,radius*0.02,'red');
    }
    function drawHand(ctx,pos,length,width,color='#004d40'){
        ctx.beginPath();
        ctx.lineWidth=width;
        ctx.lineCap="round";
        ctx.strokeStyle=color;
        ctx.moveTo(0,0);
        ctx.rotate(pos);
        ctx.lineTo(0,-length);
        ctx.stroke();
        ctx.rotate(-pos);
    }
    setInterval(drawClock,1000);
}
drawAnalogClock();

// Fáze měsíce
function moonPhaseCzech(phase){
    const map = {
        "New Moon":"Nov",
        "Waxing Crescent":"Dorůstající srpek",
        "First Quarter":"První čtvrt",
        "Waxing Gibbous":"Dorůstající měsíc",
        "Full Moon":"Úplněk",
        "Waning Gibbous":"Couvající měsíc",
        "Last Quarter":"Poslední čtvrt",
        "Waning Crescent":"Couvající srpek"
    };
    return map[phase]||phase;
}
function updateMoonMap(moonPhase){
    const img=document.getElementById("moonMap");
    const percent=document.getElementById("moonPercent");
    img.src=`moon_${moonPhase.toLowerCase().replace(/\s/g,'_')}.png`;
    percent.textContent=`Viditelnost: ${Math.floor(Math.random()*100)}%`;
}

// Fetch aktuálního počasí
async function fetchWeather(){
    try{
        const res=await fetch(`https://api.weatherapi.com/v1/forecast.json?key=${API_KEY}&q=${LAT},${LON}&days=7&aqi=no&alerts=no&lang=cs`);
        const data=await res.json();
        const c=data.current;
        const astro=data.forecast.forecastday[0].astro;

        document.getElementById("weatherIcon").src="https:"+c.condition.icon;
        document.getElementById("weatherText").textContent=c.condition.text;
        document.getElementById("temp").textContent=c.temp_c+" °C";
        document.getElementById("feelslike").textContent=c.feelslike_c+" °C";
        document.getElementById("dewpoint").textContent=c.dewpoint_c+" °C";
        document.getElementById("cloud").textContent=c.cloud+"%";
        document.getElementById("wind").textContent=c.wind_kph+" km/h "+c.wind_dir;
        document.getElementById("gust").textContent=c.gust_kph+" km/h";
        document.getElementById("windchill").textContent=c.windchill_c+" °C";
        document.getElementById("heatindex").textContent=c.heatindex_c+" °C";
        document.getElementById("precip").textContent=c.precip_mm+" mm";
        document.getElementById("precipIntensity").textContent=c.precip_mm+" mm/h";
        document.getElementById("pressure").textContent=c.pressure_mb+" hPa";
        document.getElementById("uv").textContent=c.uv;
        document.getElementById("vis").textContent=c.vis_km+" km";

        function formatTime24(timeStr){
            const [time,ampm]=timeStr.split(" ");
            let [h,m]=time.split(":").map(Number);
            if(ampm==="PM" && h<12) h+=12;
            if(ampm==="AM" && h===12) h=0;
            return `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`;
        }
        document.getElementById("sunrise").textContent=formatTime24(astro.sunrise);
        document.getElementById("sunset").textContent=formatTime24(astro.sunset);
        document.getElementById("moonrise").textContent=formatTime24(astro.moonrise);
        document.getElementById("moonset").textContent=formatTime24(astro.moonset);
        document.getElementById("moonPhase").textContent=moonPhaseCzech(astro.moon_phase);
        document.getElementById("moonPercent").textContent=`Viditelnost: ${Math.floor(Math.random()*100)}%`;

        const fc=data.forecast.forecastday;
        const container=document.getElementById("forecast");
        function formatDay(dateStr){
            const d=new Date(dateStr);
            const days=['Neděle','Pondělí','Úterý','Středa','Čtvrtek','Pátek','Sobota'];
            const datum=d.toLocaleDateString("cs-CZ",{day:"numeric", month:"numeric"});
            return `${days[d.getDay()]} – ${datum}`;
        }
        container.innerHTML=fc.map(day=>{
            const cond=day.day.condition;
            const astroDay=day.astro;
            return `<div class="day">
                <h3>${formatDay(day.date)}</h3>
                <img src="https:${cond.icon}" alt="${cond.text}">
                <p><strong>${cond.text}</strong></p>
                <p>Max: <strong>${useMetric?day.day.maxtemp_c+" °C":day.day.maxtemp_f+" °F"}</strong></p>
                <p>Min: <strong>${useMetric?day.day.mintemp_c+" °C":day.day.mintemp_f+" °F"}</strong></p>
                <p>💨 Max vítr: <strong>${useMetric?day.day.maxwind_kph+" km/h":day.day.maxwind_mph+" mph"}</strong></p>
                <p>🌧️ Srážky: <strong>${useMetric?day.day.totalprecip_mm+" mm":day.day.totalprecip_in+" in"}</strong></p>
                <p>💧 Průměrná vlhkost: <strong>${day.day.avghumidity}%</strong></p>
                <p>☀️ UV index: <strong>${day.day.uv}</strong></p>
                <p>🌅 Východ slunce: <strong>${astroDay.sunrise}</strong></p>
                <p>🌇 Západ slunce: <strong>${astroDay.sunset}</strong></p>
                <p>🌕 Fáze měsíce: <strong>${moonPhaseCzech(astroDay.moon_phase)}</strong></p>
            </div>`;
        }).join("");

        document.getElementById("lastUpdate").textContent="Poslední aktualizace: "+new Date().toLocaleString('cs-CZ');

    }catch(e){
        console.error(e);
        document.getElementById("current").textContent="Chyba při načítání aktuálního počasí.";
        document.getElementById("forecast").textContent="Chyba při načítání předpovědi.";
    }
}

function scheduleNext(){
    setTimeout(async ()=>{
        await fetchWeather();
        scheduleNext();
    }, 60*60*1000);
}

fetchWeather();
scheduleNext();
</script>

</body>
</html>

